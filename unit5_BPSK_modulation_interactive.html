<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BPSK æ•™å­¸äº’å‹•æ¨¡æ“¬å™¨</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- MathJax (å·²åŒ…å«æ‚¨å»ºè­°çš„è¡Œå…§å…¬å¼è¨­å®š) -->
    <script>
        window.MathJax = { tex: { inlineMath: [['$','$'], ['\\(','\\)']] } };
    </script>
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body { background:#0f172a; color:#e5e7eb; font-family:Inter, sans-serif; }
        .container { max-width:1100px; margin:24px auto; padding:16px; }
        .card { background:#111827; border:1px solid rgba(99,102,241,0.12); border-radius:12px; padding:12px; }
        canvas { width:100%; height:auto; display:block; border-radius:8px; }
        /* æ›´æ”¹ä½å…ƒé¡¯ç¤ºæ¨£å¼ï¼Œå› ç‚ºç¾åœ¨æ˜¯æ¥µæ€§NRZ */
        .bit-pill { font-family:monospace; padding:.25rem .5rem; border-radius:.25rem; font-weight: bold; }
        .bit-1 { background:#16a34a; color:white; } /* +1 */
        .bit-0 { background:#dc2626; color:white; } /* -1 (ä¾†è‡ªåŸå§‹ 0) */
        input[type=range]::-webkit-slider-thumb { -webkit-appearance:none; width:16px; height:16px; border-radius:50%; background:#8b5cf6; }
        .btn { padding:.4rem .75rem; border-radius:.375rem; cursor:pointer; border:none; transition: background-color 0.2s; }
        .btn-refresh { background:#06b6d4; color:white; }
        .btn-refresh:hover { background:#0891b2; }
    </style>
</head>
<body>

<div class="container">
    <header class="mb-4 text-center">
        <h1 class="text-3xl font-bold text-sky-300">BPSK æ•™å­¸äº’å‹•æ¨¡æ“¬å™¨ï¼ˆBPSKï¼‰</h1>
        <h1 class="text-2xl font-extrabold text-[#78c9ff] mb-1">ä½œè€…ï¼šäºæ±ç§‘æŠ€å¤§å­¸é€šè¨Šå·¥ç¨‹ç³» é™³ä¿Šå®</h1>
        <p class="text-sm text-gray-400">BPSKï¼šå°‡æ•¸ä½è³‡æ–™è½‰æ›ç‚ºæ¥µæ€§ NRZ ($+1, -1$)ï¼Œå†ä¹˜ä¸Šè¼‰æ³¢é€²è¡Œèª¿è®Šã€‚
            <br>è¼‰æ³¢é »ç‡ $f_c$ å›ºå®šç‚º $2 \times$ ä½å…ƒé€Ÿç‡ $R_b$ã€‚
        </p>
    </header>

    <div class="card mb-4">
        <h2 class="text-lg text-pink-300 mb-2">è³‡æ–™æ§åˆ¶</h2>
        <div class="flex flex-wrap items-center justify-between gap-4">
            <div class="flex items-center gap-4">
                <button id="refreshBits" class="btn btn-refresh">ğŸ”„ é‡æ–°ç”¢ç”Ÿ 10 å€‹ä½å…ƒ</button>
                <div>
                    <div class="text-sm text-gray-300">åŸå§‹æ•¸ä½åºåˆ— (10 bits)</div>
                    <div id="bitSequenceDisplay" class="mt-2 flex gap-2 flex-wrap"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-4">
        <div class="card">
            <h3 class="text-yellow-300 mb-2">æ¥µæ€§ NRZ è³‡æ–™ $b'(t)$</h3>
            <canvas id="dataCanvas" height="140"></canvas>
        </div>
        <div class="card">
            <h3 class="text-yellow-300 mb-2">è¼‰æ³¢ $c(t)$</h3>
            <canvas id="carrierCanvas" height="140"></canvas>
        </div>
        <div class="card">
            <h3 class="text-yellow-300 mb-2">BPSK è¨Šè™Ÿ $s(t)$</h3>
            <canvas id="bpskCanvas" height="140"></canvas>
        </div>
    </div>

    <div class="card mb-4">
        <h2 class="text-lg text-indigo-300 mb-2">åƒæ•¸æ§åˆ¶</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm text-purple-300 mb-1">è¼‰æ³¢æŒ¯å¹… $A$ (V)</label>
                <input id="carrier_amplitude" type="range" min="0.2" max="2.0" step="0.1" value="1.0" class="w-full">
                <div id="carrier_amplitude_value" class="mt-1 text-center font-bold">1.0 V</div>
            </div>
            <div>
                <label class="block text-sm text-purple-300 mb-1">ä½å…ƒé€Ÿç‡ $R_b$ (Bits/s)</label>
                <input id="bit_rate" type="range" min="1" max="8" step="0.5" value="2" class="w-full">
                <div id="bit_rate_value" class="mt-1 text-center font-bold">2.0 Bits/s</div>
            </div>
        </div>
    </div>

    <div id="infoDisplay" class="card text-sm font-mono p-3"></div>
</div>

<script>
(function(){
    // å›ºå®šåƒæ•¸
    const FIXED_CYCLES_PER_BIT = 2; // f_c = 2 * R_b
    const FIXED_SAMPLE_RATE = 1000; // æ¯ç§’å–æ¨£é»æ•¸

    // elements
    const dataCanvas = document.getElementById('dataCanvas');
    const carrierCanvas = document.getElementById('carrierCanvas');
    const bpskCanvas = document.getElementById('bpskCanvas'); // æ›´æ”¹ ID
    const dataCtx = dataCanvas.getContext('2d');
    const carCtx = carrierCanvas.getContext('2d');
    const bpskCtx = bpskCanvas.getContext('2d'); // æ›´æ”¹ Context

    const refreshBtn = document.getElementById('refreshBits');
    const bitDisplay = document.getElementById('bitSequenceDisplay');
    const carrierAmpInput = document.getElementById('carrier_amplitude');
    const bitRateInput = document.getElementById('bit_rate');
    const infoDisplay = document.getElementById('infoDisplay');

    // params
    let numBits = 10;
    let bits = randomBits(numBits); // 0 or 1
    let Rb = parseFloat(bitRateInput.value);
    let A = parseFloat(carrierAmpInput.value);
    let fc = FIXED_CYCLES_PER_BIT * Rb;

    function randomBits(n){ const a=[]; for(let i=0;i<n;i++) a.push(Math.round(Math.random())); return a; }

    function showBits(){ 
        bitDisplay.innerHTML=''; 
        bits.forEach(b=>{ 
            const d=document.createElement('div'); 
            // é¡¯ç¤ºåŸå§‹ä½å…ƒå€¼ï¼Œä½†ç”¨é¡è‰²å€åˆ† BPSK çš„ç›¸ä½
            d.className='bit-pill '+(b? 'bit-1':'bit-0'); 
            d.textContent=b; 
            bitDisplay.appendChild(d); 
        }); 
    }

    function resize(){ 
        const w = dataCanvas.parentElement.clientWidth; 
        [dataCanvas,carrierCanvas,bpskCanvas].forEach(c=>{ 
            c.width=w; 
            c.height=140; 
        }); 
        renderAll(); 
    }

    /**
     * @description ç¹ªè£½å–®ä¸€æ³¢å½¢
     * @param {CanvasRenderingContext2D} ctx - Canvas Context
     * @param {Array<number>} data - è¨Šè™Ÿæ•¸æ“š
     * @param {string} color - ç·šæ¢é¡è‰²
     * @param {number} yRange - å‚ç›´ç¯„åœ (ä¾‹å¦‚ï¼š1.2 for +/-1.2, A for +/-A)
     */
    function drawSignal(ctx, data, color, yRange){ 
        if(!data) return; 
        ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height); 
        
        const mid=ctx.canvas.height/2; // center
        
        // Draw center line
        ctx.beginPath(); 
        ctx.strokeStyle='#374151'; 
        ctx.lineWidth=1; 
        ctx.moveTo(0,mid); 
        ctx.lineTo(ctx.canvas.width,mid); 
        ctx.stroke(); 

        // Draw signal
        ctx.beginPath(); 
        ctx.strokeStyle=color; 
        ctx.lineWidth=2; 
        const scaleY=(mid*0.8)/yRange; 
        ctx.moveTo(0, mid - data[0]*scaleY); 
        
        for(let i=1;i<data.length;i++){ 
            const x=(i/data.length)*ctx.canvas.width; 
            const y=mid - data[i]*scaleY; 
            ctx.lineTo(x,y);
        } 
        ctx.stroke(); 
        
        // Draw bit separators
        drawBitSeparators([ctx], numBits, data.length, 1.0/Rb, numBits/Rb);
    }

    function renderAll(){
        // recalc
        Rb = parseFloat(bitRateInput.value);
        A = parseFloat(carrierAmpInput.value);
        // BPSK æ ¸å¿ƒé »ç‡é‚è¼¯: fc = 5 * Rb
        fc = FIXED_CYCLES_PER_BIT * Rb; 

        const Tb = 1.0/Rb;
        const timeDuration = numBits / Rb;
        const N = Math.round(FIXED_SAMPLE_RATE * timeDuration);

        // --- 1. æ¥µæ€§ NRZ è³‡æ–™ b'(t) (-1 or +1) ---
        const bPrime = new Array(N);
        for(let i=0;i<N;i++){ 
            const t=i/FIXED_SAMPLE_RATE; 
            const idx=Math.floor(t/Tb); 
            const bit = bits[idx]||0; 
            // è½‰æ›ï¼š 0 -> -1, 1 -> +1
            bPrime[i] = (bit === 1) ? 1.0 : -1.0; 
        }
        // ç¹ªè£½æ¥µæ€§ NRZ è³‡æ–™ï¼Œä½¿ç”¨ç¯„åœ 1.2 å®¹ç´ +/- 1
        drawSignal(dataCtx, bPrime, '#f59e0b', 1.2);

        // --- 2. è¼‰æ³¢è¨Šè™Ÿ c(t) ---
        const carrier = new Array(N);
        for(let i=0;i<N;i++){ 
            const t=i/FIXED_SAMPLE_RATE; 
            // c(t) = A * cos(2 * pi * fc * t)
            carrier[i]=A*Math.cos(2*Math.PI*fc*t); 
        }
        // ç¹ªè£½è¼‰æ³¢
        drawSignal(carCtx, carrier, '#60a5fa', A);

        // --- 3. BPSK è¨Šè™Ÿ s(t) ---
        const bpsk = new Array(N);
        for(let i=0;i<N;i++){
            // s(t) = b'(t) * c(t)
            bpsk[i] = bPrime[i] * carrier[i];
        }
        // ç¹ªè£½ BPSK è¨Šè™Ÿ
        drawSignal(bpskCtx, bpsk, '#c084fc', A);

        // update info panel
        infoDisplay.innerHTML = `
            <div style="padding:8px;border:1px solid #374151;border-radius:6px;margin-bottom:6px;">BPSK èª¿è®Šå…¬å¼: $s(t) = b'(t) \\cdot A \\cos(2\\pi f_c t)$</div>
            <div style="display:flex;gap:12px;flex-wrap:wrap"> 
                <div style="padding:8px;border:1px solid #374151;border-radius:6px">è¼‰æ³¢æŒ¯å¹… $A$ = <strong>${A.toFixed(1)}</strong> V</div>
                <div style="padding:8px;border:1px solid #374151;border-radius:6px">ä½å…ƒé€Ÿç‡ $R_b$ = <strong>${Rb.toFixed(1)}</strong> bits/s</div>
                <div style="padding:8px;border:1px solid #374151;border-radius:6px">è¼‰æ³¢é »ç‡ $f_c$ = <strong>${fc.toFixed(1)}</strong> Hz ($2 R_b$)</div>
                <div style="padding:8px;border:1px solid #374151;border-radius:6px">é€±æœŸ/ä½å…ƒ $f_c/R_b$ = <strong>${FIXED_CYCLES_PER_BIT}</strong></div>
            </div>
        `;
        if(typeof MathJax!=='undefined' && MathJax.typesetPromise) MathJax.typesetPromise([infoDisplay]).catch(()=>{});

        // Update slider values
        document.getElementById('carrier_amplitude_value').textContent = A.toFixed(1) + " V";
        document.getElementById('bit_rate_value').textContent = Rb.toFixed(1) + " Bits/s";
    }

    /**
     * @description ç¹ªè£½ä½å…ƒé€±æœŸåˆ†éš”ç·š
     * @param {Array<CanvasRenderingContext2D>} ctxs - æ‰€æœ‰éœ€è¦ç•«åˆ†éš”ç·šçš„ Context
     * @param {number} numBits - ç¸½ä½å…ƒæ•¸
     * @param {number} N - ç¸½å–æ¨£é»æ•¸
     * @param {number} Tb - ä½å…ƒæŒçºŒæ™‚é–“
     * @param {number} timeDuration - ç¸½æ™‚é–“
     */
    function drawBitSeparators(ctxs, numBits, N, Tb, timeDuration){
        const samplesPerBit = N/numBits;
        ctxs.forEach(ctx=>{
            ctx.save(); 
            ctx.strokeStyle='rgba(255,255,255,0.06)'; 
            ctx.lineWidth=1;
            for(let i=1;i<numBits;i++){
                const x = (i * samplesPerBit / N) * ctx.canvas.width;
                ctx.beginPath(); 
                ctx.moveTo(x,0); 
                ctx.lineTo(x,ctx.canvas.height); 
                ctx.stroke();
            }
            ctx.restore();
        });
    }

    // events
    bitRateInput.addEventListener('input', renderAll);
    carrierAmpInput.addEventListener('input', renderAll);

    refreshBtn.addEventListener('click', ()=>{ 
        bits = randomBits(numBits); 
        showBits(); 
        renderAll(); 
    });

    window.addEventListener('resize', resize);
    window.onload = ()=>{ showBits(); resize(); };

})();
</script>

</body>
</html>